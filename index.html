<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Devocional ‚Ä¢ Vers√≠culos ACF</title>

  <!-- Fonte -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  >

  <style>
    :root {
      --glass-bg: rgba(15, 23, 42, 0.50);   /* mais transparente */
      --glass-border: rgba(148, 163, 184, 0.45);
      --text-main: #e5e7eb;
      --text-muted: #cbd5f5;
      --accent: #facc15;
      --accent-soft: rgba(250, 204, 21, 0.16);
      --success: #22c55e;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: #000;
      overflow: hidden;
    }

    /* ============================
       FUNDO (80% VIS√çVEL)
       ============================ */
    .bg-image {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: brightness(0.9);   /* imagem bem vis√≠vel */
      z-index: -2;
      transition: background-image 0.7s ease-out, filter 0.4s ease-out;
    }

    .bg-overlay {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at top, rgba(0, 0, 0, 0.10) 0, rgba(0, 0, 0, 0.30) 55%, rgba(0, 0, 0, 0.40) 100%);
      z-index: -1;
      /* sobreposi√ß√£o leve, deixa ~80% da imagem vis√≠vel */
    }

    .app {
      max-width: 980px;
      width: 100%;
    }

    .card {
      background: var(--glass-bg);
      border-radius: 1.8rem;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      padding: 24px 20px 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
    }

    @media (min-width: 768px) {
      .card {
        padding: 30px 32px 24px;
      }
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 22px;
      flex-wrap: wrap;
    }

    .title-area {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.65);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .title {
      font-size: clamp(1.5rem, 3vw, 1.9rem);
      font-weight: 600;
      letter-spacing: -0.03em;
      text-shadow: 0 0 10px rgba(0,0,0,0.45);
    }

    .title span.brand {
      background: linear-gradient(135deg, #facc15, #22d3ee);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .subtitle {
      font-size: 0.86rem;
      color: var(--text-muted);
      max-width: 440px;
    }

    .timer-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.65);
      border: 1px solid rgba(148, 163, 184, 0.65);
      font-size: 0.76rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .layout {
      display: grid;
      gap: 20px;
    }

    @media (min-width: 780px) {
      .layout {
        grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.2fr);
        align-items: stretch;
      }
    }

    .verse-card {
      position: relative;
      border-radius: 1.5rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 18px 18px 16px;
      background: rgba(15, 23, 42, 0.55);
      overflow: hidden;
    }

    .verse-ref {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .version-tag {
      font-size: 0.68rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .verse-text {
      font-size: clamp(1.15rem, 2.2vw, 1.45rem);
      line-height: 1.85;
      margin-bottom: 16px;
      font-weight: 400;
      text-shadow: 0 0 8px rgba(0,0,0,0.5);
    }

    .verse-helper {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .controls-card {
      border-radius: 1.4rem;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: linear-gradient(
        145deg,
        rgba(15, 23, 42, 0.9),
        rgba(15, 23, 42, 0.82)
      );
      padding: 16px 16px 14px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 14px;
    }

    .progress-title {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .progress-sub {
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .progress-bar-wrapper {
      margin-top: 10px;
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, #facc15, #22d3ee);
      transition: width 0.3s linear;
    }

    .progress-footer {
      margin-top: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-muted);
      gap: 6px;
      flex-wrap: wrap;
    }

    .stat-pill {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      font-size: 0.74rem;
    }

    .primary-button {
      margin-top: 8px;
      padding: 12px 0;
      border-radius: 999px;
      border: none;
      width: 100%;
      font-size: 1rem;
      background: radial-gradient(circle at 0% 0%, #facc15, #f97316);
      color: #111827;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 12px 30px rgba(249, 115, 22, 0.55);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .primary-button span.chevron {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.3);
      font-size: 0.8rem;
    }

    .footer {
      margin-top: 14px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.7rem;
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.9);
    }

    /* Anima√ß√£o suave */
    .fade-enter {
      opacity: 0;
      transform: translateY(6px);
    }
    .fade-enter-active {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.22s ease-out, transform 0.22s ease-out;
    }
  </style>

</head>

<body>

  <div class="bg-image" id="bgImage"></div>
  <div class="bg-overlay"></div>

  <main class="app">
    <section class="card">

      <header class="header">
        <div class="title-area">
          <div class="badge">
            <span class="badge-dot"></span>
            <span>Devocional ‚Ä¢ ACF</span>
          </div>
          <h1 class="title">
            Versos em <span class="brand">foco</span>
          </h1>
          <p class="subtitle">
            Um vers√≠culo por vez, numa paisagem tranquila, para voc√™ respirar, meditar e conversar com Deus.
          </p>
        </div>

        <div class="timer-pill">
          Pr√≥xima troca em <strong id="countdown">60s</strong>
        </div>
      </header>

      <section class="layout">

        <article class="verse-card">
          <div class="verse-ref" id="verseRef">
            <span>Carregando‚Ä¶</span>
            <span class="version-tag">ALMEIDA</span>
          </div>

          <p class="verse-text" id="verseText">
            Preparando o devocional de hoje‚Ä¶
          </p>

          <p class="verse-helper">
            Quando o vers√≠culo aparecer, leia devagar, medite e use a paisagem ao fundo como cen√°rio para a sua ora√ß√£o.
          </p>
        </article>

        <aside class="controls-card">
          <div>
            <p class="progress-title">Sess√£o de leitura</p>
            <p class="progress-sub">
              Vers√≠culos exibidos hoje:
              <strong id="currentIndexLabel">0</strong>
            </p>

            <div class="progress-bar-wrapper">
              <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="progress-footer">
              <span>Pr√≥xima troca em <strong id="countdownInline">60s</strong></span>
              <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                <span class="stat-pill">
                  <span id="readCount">0</span> lidos
                </span>
                <span class="stat-pill" id="loopIndicator">
                  Come√ßando agora ‚ú®
                </span>
              </div>
            </div>
          </div>

          <button class="primary-button" id="nextButton" type="button">
            <span>Pr√≥ximo vers√≠culo</span>
            <span class="chevron">‚ûú</span>
          </button>
        </aside>

      </section>

      <footer class="footer">
        <div class="chips">
          <span class="chip">Bible API (tradu√ß√£o ‚Äúalmeida‚Äù)</span>
          <span class="chip">Paisagem aleat√≥ria</span>
          <span class="chip">Auto a cada 1 min</span>
        </div>
        <span>Use sua B√≠blia ACF para ler o contexto completo.</span>
      </footer>

    </section>
  </main>

  <script>
    // =========================
    // CONFIGURA√á√ïES
    // =========================
    const BIBLE_API_BASE = "https://bible-api.com"; // CORS liberado
    const TRANSLATION = "almeida"; // portugu√™s Jo√£o Ferreira de Almeida
    const INTERVAL_MS = 60000;

    // fundo
    function refreshBackground() {
      const url = "https://picsum.photos/1600/900?blur=1&random=" + Date.now();
      document.getElementById("bgImage").style.backgroundImage = `url(${url})`;
    }

    // elementos
    const verseRefEl = document.getElementById("verseRef");
    const verseTextEl = document.getElementById("verseText");
    const countdownEl = document.getElementById("countdown");
    const countdownInlineEl = document.getElementById("countdownInline");
    const progressBarEl = document.getElementById("progressBar");
    const readCountEl = document.getElementById("readCount");
    const currentIndexLabelEl = document.getElementById("currentIndexLabel");
    const loopIndicatorEl = document.getElementById("loopIndicator");
    const nextButton = document.getElementById("nextButton");

    let remaining = INTERVAL_MS;
    let timerId = null;
    let readCount = 0;
    let isLoading = false;

    // =========================
    // API: VERS√çCULO ALEAT√ìRIO
    // =========================
    async function fetchRandomVerse() {
      // endpoint /data/random com tradu√ß√£o por query
      const url = `${BIBLE_API_BASE}/data/random?translation=${encodeURIComponent(TRANSLATION)}`;

      const res = await fetch(url);
      if (!res.ok) {
        throw new Error("Falha na Bible API");
      }
      const data = await res.json();

      // Formato esperado: igual ao /John+3:16
      // { reference, text, verses:[{book_name,chapter,verse,text,...}], ... }
      let reference = data.reference || "";
      let text = "";

      if (Array.isArray(data.verses) && data.verses.length > 0) {
        const v = data.verses[0];
        reference = reference || `${v.book_name || v.book_id || ""} ${v.chapter}:${v.verse}`;
        text = (v.text || data.text || "").trim();
      } else {
        text = (data.text || "").trim();
      }

      if (!text) {
        throw new Error("Resposta sem texto");
      }

      return { reference, text };
    }

    // =========================
    // UI
    // =========================
    function animateVerse() {
      verseTextEl.classList.remove("fade-enter", "fade-enter-active");
      void verseTextEl.offsetWidth;
      verseTextEl.classList.add("fade-enter");
      requestAnimationFrame(() => {
        verseTextEl.classList.add("fade-enter-active");
      });
    }

    async function loadAndShowVerse() {
      if (isLoading) return;
      isLoading = true;

      verseRefEl.innerHTML = `<span>Carregando‚Ä¶</span><span class="version-tag">ALMEIDA</span>`;
      verseTextEl.textContent = "Buscando vers√≠culo na Bible API‚Ä¶";

      try {
        const verse = await fetchRandomVerse();

        verseRefEl.innerHTML = `<span>${verse.reference}</span><span class="version-tag">ALMEIDA</span>`;
        verseTextEl.textContent = verse.text;

        readCount++;
        readCountEl.textContent = String(readCount);
        currentIndexLabelEl.textContent = String(readCount);

        if (readCount === 1) {
          loopIndicatorEl.textContent = "Primeiro passo do dia üôå";
        } else if (readCount < 10) {
          loopIndicatorEl.textContent = "Ritmo bom de medita√ß√£o üíõ";
        } else {
          loopIndicatorEl.textContent = "Sess√£o profunda de leitura üî•";
        }

        animateVerse();
        refreshBackground();
      } catch (err) {
        console.error(err);
        verseRefEl.innerHTML = `<span>Erro ao carregar</span><span class="version-tag">ALMEIDA</span>`;
        verseTextEl.textContent =
          "Erro ao carregar o vers√≠culo na Bible API. Toque em \"Pr√≥ximo vers√≠culo\" para tentar de novo.";
      } finally {
        isLoading = false;
      }
    }

    // =========================
    // TIMER
    // =========================
    function updateTimer() {
      const sec = Math.ceil(remaining / 1000) + "s";
      countdownEl.textContent = sec;
      countdownInlineEl.textContent = sec;

      const percentage = 100 - (remaining / INTERVAL_MS) * 100;
      progressBarEl.style.width = percentage + "%";
    }

    function startTimer() {
      if (timerId) clearInterval(timerId);
      remaining = INTERVAL_MS;
      updateTimer();

      timerId = setInterval(() => {
        remaining -= 1000;
        if (remaining <= 0) {
          remaining = INTERVAL_MS;
          updateTimer();
          loadAndShowVerse();
        } else {
          updateTimer();
        }
      }, 1000);
    }

    function resetTimer() {
      remaining = INTERVAL_MS;
      updateTimer();
    }

    // =========================
    // INICIALIZA√á√ÉO
    // =========================
    refreshBackground();
    loadAndShowVerse();
    startTimer();

    nextButton.addEventListener("click", () => {
      resetTimer();
      loadAndShowVerse();
    });
  </script>
</body>

</html>
